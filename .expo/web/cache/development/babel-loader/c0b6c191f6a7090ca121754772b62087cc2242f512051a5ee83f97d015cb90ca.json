{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nimport { createSlice, createAsyncThunk } from \"@reduxjs/toolkit\";\nimport { getFirestore, collection, where, query, getDocs, addDoc, getDoc, doc, updateDoc, deleteDoc } from \"firebase/firestore\";\nexport var fetchCanals = createAsyncThunk(\"canals/fetchCanals\", function () {\n  var _ref2 = _asyncToGenerator(function* (userId, _ref) {\n    var rejectWithValue = _ref.rejectWithValue;\n    try {\n      var db = getFirestore();\n      var userCanalsRef = collection(db, \"userCanals\");\n      var userCanalsQuery = query(userCanalsRef, where(\"userId\", \"==\", userId));\n      var userCanalsSnapshot = yield getDocs(userCanalsQuery);\n      var canalIds = userCanalsSnapshot.docs.map(function (doc) {\n        return doc.data().canalId;\n      });\n      var canalsData = [];\n      for (var canalId of canalIds) {\n        var canalRef = doc(db, \"canals\", canalId);\n        var canalSnapshot = yield getDoc(canalRef);\n        if (canalSnapshot.exists()) {\n          var canalData = canalSnapshot.data();\n          var isAdmin = false;\n          if (Array.isArray(canalData.role)) {\n            for (var role of canalData.role) {\n              if (role.uid === userId && role.isAdmin) {\n                isAdmin = true;\n                break;\n              }\n            }\n          }\n          canalsData.push(_objectSpread({\n            id: canalId,\n            isAdmin: isAdmin\n          }, canalData));\n        }\n      }\n      return canalsData;\n    } catch (err) {\n      return rejectWithValue(err.message || \"Unknown error\");\n    }\n  });\n  return function (_x, _x2) {\n    return _ref2.apply(this, arguments);\n  };\n}());\nexport var addCanal = createAsyncThunk(\"canals/addCanal\", function () {\n  var _ref5 = _asyncToGenerator(function* (_ref3, _ref4) {\n    var userId = _ref3.userId,\n      canalData = _ref3.canalData;\n    var rejectWithValue = _ref4.rejectWithValue;\n    try {\n      var db = getFirestore();\n      var canalRef = collection(db, \"canals\");\n      var newCanalRef = yield addDoc(canalRef, canalData);\n      var newCanalSnapshot = yield getDoc(newCanalRef);\n      var newCanal = _objectSpread({\n        id: newCanalRef.id\n      }, newCanalSnapshot.data());\n      var userCanalsRef = collection(db, \"userCanals\");\n      yield addDoc(userCanalsRef, {\n        userId: userId,\n        canalId: newCanal.id\n      });\n      return newCanal;\n    } catch (error) {\n      return rejectWithValue(error.message);\n    }\n  });\n  return function (_x3, _x4) {\n    return _ref5.apply(this, arguments);\n  };\n}());\nexport var updateCanal = createAsyncThunk(\"canal/updateCanal\", function () {\n  var _ref8 = _asyncToGenerator(function* (_ref6, _ref7) {\n    var canalId = _ref6.canalId,\n      canalData = _ref6.canalData;\n    var rejectWithValue = _ref7.rejectWithValue;\n    try {\n      var db = getFirestore();\n      var canalRef = doc(db, \"canals\", canalId);\n      yield updateDoc(canalRef, canalData);\n      var animalsRef = collection(db, \"animals\");\n      var querySnapshot = yield getDocs(query(animalsRef, where(\"canalId\", \"==\", canalId)));\n      var promises = querySnapshot.docs.map(function (doc) {\n        var animalRef = doc.ref;\n        return updateDoc(animalRef, {\n          canalName: canalData.name\n        });\n      });\n      yield Promise.all(promises);\n      return {\n        canalId: canalId,\n        canalData: canalData\n      };\n    } catch (error) {\n      console.log(error);\n      console.log('ASSOCIATION ID -> ');\n      console.log(canalId);\n      console.log('ASSOCIATION DATA -> ');\n      console.log(canalData);\n      return rejectWithValue(error.message);\n    }\n  });\n  return function (_x5, _x6) {\n    return _ref8.apply(this, arguments);\n  };\n}());\nexport var removeCanal = createAsyncThunk(\"canals/removeCanal\", function () {\n  var _ref11 = _asyncToGenerator(function* (_ref9, _ref10) {\n    var userId = _ref9.userId,\n      canalId = _ref9.canalId;\n    var rejectWithValue = _ref10.rejectWithValue;\n    console.log(\"slice\", userId, canalId);\n    try {\n      var db = getFirestore();\n      var canalRef = doc(db, \"canals\", canalId);\n      yield deleteDoc(canalRef);\n      var userCanalsQuery = query(collection(db, \"userCanals\"), where(\"userId\", \"==\", userId), where(\"canalId\", \"==\", canalId));\n      var userCanalSnapshot = yield getDocs(userCanalsQuery);\n      if (!userCanalSnapshot.empty) {\n        var docId = userCanalSnapshot.docs[0].id;\n        yield deleteDoc(doc(db, \"userCanals\", docId));\n      } else {\n        throw new Error(\"La liaison entre l'utilisateur et l'canal n'a pas été trouvée\");\n      }\n      return {\n        message: \"Canal supprimée avec succès\",\n        canalId: canalId\n      };\n    } catch (error) {\n      return rejectWithValue(error.message);\n    }\n  });\n  return function (_x7, _x8) {\n    return _ref11.apply(this, arguments);\n  };\n}());\nexport var joinCanal = createAsyncThunk(\"canals/joinCanal\", function () {\n  var _ref14 = _asyncToGenerator(function* (_ref12, _ref13) {\n    var userId = _ref12.userId,\n      canalId = _ref12.canalId;\n    var rejectWithValue = _ref13.rejectWithValue;\n    try {\n      var db = getFirestore();\n      var userRef = doc(db, \"users\", userId);\n      var userSnapshot = yield getDoc(userRef);\n      if (!userSnapshot.exists()) {\n        throw new Error(\"Utilisateur introuvable\");\n      }\n      var canalRef = doc(db, \"canals\", canalId);\n      var canalSnapshot = yield getDoc(canalRef);\n      if (!canalSnapshot.exists()) {\n        throw new Error(\"Canal introuvable\");\n      }\n      var userCanalsRef = collection(db, \"userCanals\");\n      var querySnapshot = yield getDocs(query(userCanalsRef, where(\"userId\", \"==\", userId), where(\"canalId\", \"==\", canalId)));\n      if (!querySnapshot.empty) {\n        throw new Error(\"L'utilisateur est déjà membre de cette canal\");\n      }\n      yield addDoc(userCanalsRef, {\n        userId: userId,\n        canalId: canalId\n      });\n      var newRole = {\n        uid: userId,\n        isAdmin: false\n      };\n      var canalData = canalSnapshot.data();\n      canalData.role = [].concat(_toConsumableArray(canalData.role), [newRole]);\n      yield updateDoc(canalRef, canalData);\n      var updatedCanalData = _objectSpread({\n        id: canalSnapshot.id\n      }, canalData);\n      return updatedCanalData;\n    } catch (error) {\n      return rejectWithValue(error.message);\n    }\n  });\n  return function (_x9, _x10) {\n    return _ref14.apply(this, arguments);\n  };\n}());\nexport var uploadImage = function () {\n  var _ref15 = _asyncToGenerator(function* (image) {\n    try {\n      var storage = getStorage();\n      var storageRef = ref(storage, `images/${image.name}`);\n      yield uploadBytes(storageRef, image);\n      var imageUrl = yield getDownloadURL(storageRef);\n      return imageUrl;\n    } catch (error) {\n      throw new Error(`Une erreur s'est produite lors du téléchargement de l'image : ${error.message}`);\n    }\n  });\n  return function uploadImage(_x11) {\n    return _ref15.apply(this, arguments);\n  };\n}();\nexport var updateCanalImage = createAsyncThunk(\"animals/updateCanalImage\", function () {\n  var _ref18 = _asyncToGenerator(function* (_ref16, _ref17) {\n    var canalId = _ref16.canalId,\n      image = _ref16.image;\n    var rejectWithValue = _ref17.rejectWithValue;\n    try {\n      var imageUrl = yield uploadImage(image);\n      var db = getFirestore();\n      var animalRef = doc(db, \"canals\", canalId);\n      yield updateDoc(animalRef, {\n        image: imageUrl\n      });\n      return {\n        canalId: canalId,\n        imageUrl: imageUrl\n      };\n    } catch (error) {\n      return rejectWithValue(error.message);\n    }\n  });\n  return function (_x12, _x13) {\n    return _ref18.apply(this, arguments);\n  };\n}());\nexport var changeUserRole = createAsyncThunk(\"canals/changeUserRole\", function () {\n  var _ref21 = _asyncToGenerator(function* (_ref19, _ref20) {\n    var userId = _ref19.userId,\n      canalId = _ref19.canalId,\n      newIsAdmin = _ref19.newIsAdmin;\n    var rejectWithValue = _ref20.rejectWithValue;\n    console.log('INFORMATIONS CHANGE USER ROLE -> ');\n    console.log(userId, canalId, newIsAdmin);\n    console.log('----');\n    try {\n      var db = getFirestore();\n      var userRef = doc(db, \"users\", userId);\n      var userSnapshot = yield getDoc(userRef);\n      if (!userSnapshot.exists()) {\n        throw new Error(\"Utilisateur introuvable\");\n      }\n      var canalRef = doc(db, \"canals\", canalId);\n      var canalSnapshot = yield getDoc(canalRef);\n      if (!canalSnapshot.exists()) {\n        throw new Error(\"Canal introuvable\");\n      }\n      var canalData = canalSnapshot.data();\n      for (var role of canalData.role) {\n        if (role.uid === userId) {\n          role.isAdmin = newIsAdmin;\n          break;\n        }\n      }\n      yield updateDoc(canalRef, canalData);\n      var updatedCanalData = _objectSpread({\n        id: canalSnapshot.id\n      }, canalData);\n      return updatedCanalData;\n    } catch (error) {\n      return rejectWithValue(error.message);\n    }\n  });\n  return function (_x14, _x15) {\n    return _ref21.apply(this, arguments);\n  };\n}());\nvar canalsSlice = createSlice({\n  name: \"canals\",\n  initialState: {\n    status: \"idle\",\n    data: [],\n    error: null\n  },\n  reducers: {},\n  extraReducers: function extraReducers(builder) {\n    builder.addCase(fetchCanals.pending, function (state) {\n      state.status = \"loading\";\n    }).addCase(fetchCanals.fulfilled, function (state, action) {\n      state.status = \"succeeded\";\n      state.data = action.payload;\n    }).addCase(fetchCanals.rejected, function (state, action) {\n      state.status = \"failed\";\n      state.error = action.payload;\n    }).addCase(addCanal.pending, function (state) {\n      state.status = \"loading\";\n    }).addCase(addCanal.fulfilled, function (state, action) {\n      state.status = \"succeeded\";\n      state.data.push(action.payload);\n    }).addCase(addCanal.rejected, function (state, action) {\n      state.status = \"failed\";\n      state.error = action.payload;\n    }).addCase(updateCanal.pending, function (state) {\n      state.status = \"loading\";\n    }).addCase(updateCanal.fulfilled, function (state, action) {\n      state.status = \"succeeded\";\n      console.log('ouyai');\n      state.data = state.data.map(function (canal) {\n        if (canal.id === action.payload.canalId) {\n          return _objectSpread(_objectSpread({}, canal), action.payload.canalData);\n        }\n        return canal;\n      });\n      if (state.selectedCanal && state.selectedCanal.id === action.payload.canalId) {\n        state.selectedCanal = _objectSpread(_objectSpread({}, state.selectedCanal), action.payload.canalData);\n      }\n    }).addCase(updateCanal.rejected, function (state, action) {\n      state.status = \"failed\";\n      state.error = action.payload;\n    });\n    builder.addCase(joinCanal.pending, function (state) {\n      state.status = \"loading\";\n    }).addCase(joinCanal.fulfilled, function (state, action) {\n      state.status = \"succeeded\";\n      state.data.push(action.payload);\n    }).addCase(joinCanal.rejected, function (state, action) {\n      state.status = \"failed\";\n      state.error = action.payload;\n    });\n    builder.addCase(changeUserRole.pending, function (state) {\n      state.status = \"loading\";\n    }).addCase(changeUserRole.fulfilled, function (state, action) {\n      state.status = \"succeeded\";\n      var index = state.data.findIndex(function (canal) {\n        return canal.id === action.payload.id;\n      });\n      if (index !== -1) {\n        state.data[index] = action.payload;\n      }\n    }).addCase(changeUserRole.rejected, function (state, action) {\n      state.status = \"failed\";\n      state.error = action.payload;\n    });\n    builder.addCase(updateCanalImage.pending, function (state) {\n      state.status = \"loading\";\n    }).addCase(updateCanalImage.fulfilled, function (state, action) {\n      state.status = \"succeeded\";\n      var _action$payload = action.payload,\n        canalId = _action$payload.canalId,\n        imageUrl = _action$payload.imageUrl;\n      var canal = state.data.find(function (canal) {\n        return canal.id === canalId;\n      });\n      if (canal) {\n        canal.image = imageUrl;\n      }\n      if (state.selectedAnimal && state.selectedAnimal.id === canalId) {\n        state.selectedAnimal.image = imageUrl;\n      }\n    }).addCase(updateCanalImage.rejected, function (state, action) {\n      state.status = \"failed\";\n      state.error = action.payload;\n    });\n    builder.addCase(removeCanal.pending, function (state) {\n      state.status = \"loading\";\n    });\n    builder.addCase(removeCanal.fulfilled, function (state, action) {\n      state.status = \"succeeded\";\n      state.data = state.data.filter(function (canal) {\n        return canal.id !== action.payload.id;\n      });\n    }).addCase(removeCanal.rejected, function (state, action) {\n      state.status = \"failed\";\n      state.error = action.payload;\n    });\n  }\n});\nexport default canalsSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","getFirestore","collection","where","query","getDocs","addDoc","getDoc","doc","updateDoc","deleteDoc","fetchCanals","_ref2","_asyncToGenerator","userId","_ref","rejectWithValue","db","userCanalsRef","userCanalsQuery","userCanalsSnapshot","canalIds","docs","map","data","canalId","canalsData","canalRef","canalSnapshot","exists","canalData","isAdmin","Array","isArray","role","uid","push","_objectSpread","id","err","message","_x","_x2","apply","arguments","addCanal","_ref5","_ref3","_ref4","newCanalRef","newCanalSnapshot","newCanal","error","_x3","_x4","updateCanal","_ref8","_ref6","_ref7","animalsRef","querySnapshot","promises","animalRef","ref","canalName","name","Promise","all","console","log","_x5","_x6","removeCanal","_ref11","_ref9","_ref10","userCanalSnapshot","empty","docId","Error","_x7","_x8","joinCanal","_ref14","_ref12","_ref13","userRef","userSnapshot","newRole","concat","_toConsumableArray","updatedCanalData","_x9","_x10","uploadImage","_ref15","image","storage","getStorage","storageRef","uploadBytes","imageUrl","getDownloadURL","_x11","updateCanalImage","_ref18","_ref16","_ref17","_x12","_x13","changeUserRole","_ref21","_ref19","_ref20","newIsAdmin","_x14","_x15","canalsSlice","initialState","status","reducers","extraReducers","builder","addCase","pending","state","fulfilled","action","payload","rejected","canal","selectedCanal","index","findIndex","_action$payload","find","selectedAnimal","filter","reducer"],"sources":["C:/Users/Benoitm/Documents/Coding/Kappze/MyKappze/src/features/canals/canalSlice.tsx"],"sourcesContent":["import {\r\n  createSlice,\r\n  createAsyncThunk,\r\n  PayloadAction,\r\n  Action,\r\n} from \"@reduxjs/toolkit\";\r\nimport {\r\n  getFirestore,\r\n  collection,\r\n  where,\r\n  query,\r\n  getDocs,\r\n  addDoc,\r\n  getDoc,\r\n  doc,\r\n  updateDoc,\r\n  deleteDoc,\r\n} from \"firebase/firestore\";\r\n\r\ninterface Canal {\r\n  id: string;\r\n  isAdmin: boolean;\r\n  [key: string]: any;\r\n}\r\n\r\ninterface CanalState {\r\n  status: string;\r\n  data: Canal[];\r\n  error: string | null;\r\n}\r\n\r\nexport const fetchCanals = createAsyncThunk<Canal[], string>(\r\n  \"canals/fetchCanals\",\r\n  async (userId: string, { rejectWithValue }) => {\r\n    try {\r\n      const db = getFirestore();\r\n      const userCanalsRef = collection(db, \"userCanals\");\r\n      const userCanalsQuery = query(\r\n        userCanalsRef,\r\n        where(\"userId\", \"==\", userId)\r\n      );\r\n      const userCanalsSnapshot = await getDocs(userCanalsQuery);\r\n      const canalIds = userCanalsSnapshot.docs.map(\r\n        (doc) => doc.data().canalId\r\n      );\r\n      const canalsData: Canal[] = [];\r\n\r\n      for (const canalId of canalIds) {\r\n        const canalRef = doc(db, \"canals\", canalId);\r\n        const canalSnapshot = await getDoc(canalRef);\r\n\r\n        if (canalSnapshot.exists()) {\r\n          const canalData = canalSnapshot.data();\r\n          let isAdmin = false;\r\n\r\n          if (Array.isArray(canalData.role)) {\r\n            for (let role of canalData.role) {\r\n              if (role.uid === userId && role.isAdmin) {\r\n                isAdmin = true;\r\n                break;\r\n              }\r\n            }\r\n          }\r\n\r\n          canalsData.push({\r\n            id: canalId,\r\n            isAdmin,\r\n            ...canalData,\r\n          });\r\n        }\r\n      }\r\n\r\n      return canalsData;\r\n    } catch (err) {\r\n      return rejectWithValue(err.message || \"Unknown error\");\r\n    }\r\n  }\r\n);\r\n\r\n/*\r\n * Create Canal\r\n ***\r\n */\r\n\r\nexport const addCanal = createAsyncThunk(\r\n  \"canals/addCanal\",\r\n  async ({ userId, canalData }, { rejectWithValue }) => {\r\n    try {\r\n      const db = getFirestore();\r\n      const canalRef = collection(db, \"canals\");\r\n      const newCanalRef = await addDoc(canalRef, canalData);\r\n      const newCanalSnapshot = await getDoc(newCanalRef);\r\n      const newCanal = {\r\n        id: newCanalRef.id,\r\n        ...newCanalSnapshot.data(),\r\n      };\r\n\r\n      // Ajoutez l'ID de l'canal à la collection \"userCanals\" de l'utilisateur\r\n      const userCanalsRef = collection(db, \"userCanals\");\r\n      await addDoc(userCanalsRef, {\r\n        userId,\r\n        canalId: newCanal.id,\r\n      });\r\n\r\n      return newCanal;\r\n    } catch (error) {\r\n      return rejectWithValue(error.message);\r\n    }\r\n  }\r\n);\r\n\r\nexport const updateCanal = createAsyncThunk(\r\n  \"canal/updateCanal\",\r\n  async ({ canalId, canalData }, { rejectWithValue }) => {\r\n\r\n\r\n    try {\r\n      const db = getFirestore();\r\n      const canalRef = doc(db, \"canals\", canalId);\r\n      await updateDoc(canalRef, canalData);\r\n\r\n      // Mise à jour des animaux associés\r\n      const animalsRef = collection(db, \"animals\");\r\n      const querySnapshot = await getDocs(\r\n        query(animalsRef, where(\"canalId\", \"==\", canalId))\r\n        \r\n      );\r\n\r\n      const promises = querySnapshot.docs.map((doc) => {\r\n        const animalRef = doc.ref;\r\n        return updateDoc(animalRef, { canalName: canalData.name});\r\n      });\r\n\r\n      await Promise.all(promises);\r\n\r\n      return { canalId, canalData };\r\n    } catch (error) {\r\n      console.log(error)\r\n      console.log('ASSOCIATION ID -> ')\r\n      console.log(canalId)\r\n      console.log('ASSOCIATION DATA -> ')\r\n      console.log(canalData)\r\n\r\n      return rejectWithValue(error.message);\r\n    }\r\n  }\r\n);\r\n\r\n/*\r\n * Delete Canal\r\n ***\r\n */\r\n\r\nexport const removeCanal = createAsyncThunk(\r\n  \"canals/removeCanal\",\r\n  async ({ userId, canalId }, { rejectWithValue }) => {\r\n    console.log(\"slice\", userId, canalId);\r\n    try {\r\n      const db = getFirestore();\r\n\r\n      // Supprimer l'canal de la collection \"canals\"\r\n      const canalRef = doc(db, \"canals\", canalId);\r\n      await deleteDoc(canalRef);\r\n\r\n      // Supprimer l'ID de l'canal de la collection \"userCanals\" de l'utilisateur\r\n      const userCanalsQuery = query(\r\n        collection(db, \"userCanals\"),\r\n        where(\"userId\", \"==\", userId),\r\n        where(\"canalId\", \"==\", canalId)\r\n      );\r\n      const userCanalSnapshot = await getDocs(userCanalsQuery);\r\n\r\n      if (!userCanalSnapshot.empty) {\r\n        // Supposons qu'il n'y ait qu'un seul document qui correspond à la requête\r\n        const docId = userCanalSnapshot.docs[0].id;\r\n        await deleteDoc(doc(db, \"userCanals\", docId));\r\n      } else {\r\n        throw new Error(\r\n          \"La liaison entre l'utilisateur et l'canal n'a pas été trouvée\"\r\n        );\r\n      }\r\n\r\n      return { message: \"Canal supprimée avec succès\", canalId };\r\n    } catch (error) {\r\n      return rejectWithValue(error.message);\r\n    }\r\n  }\r\n);\r\n\r\n/*\r\n * Join Canal\r\n ***\r\n */\r\n\r\nexport const joinCanal = createAsyncThunk(\r\n  \"canals/joinCanal\",\r\n  async ({ userId, canalId }, { rejectWithValue }) => {\r\n    try {\r\n      const db = getFirestore();\r\n\r\n      // Vérifiez si l'utilisateur existe dans la collection \"users\"\r\n      const userRef = doc(db, \"users\", userId);\r\n      const userSnapshot = await getDoc(userRef);\r\n      if (!userSnapshot.exists()) {\r\n        throw new Error(\"Utilisateur introuvable\");\r\n      }\r\n\r\n      // Vérifiez si l'canal existe dans la collection \"canals\"\r\n      const canalRef = doc(db, \"canals\", canalId);\r\n      const canalSnapshot = await getDoc(canalRef);\r\n      if (!canalSnapshot.exists()) {\r\n        throw new Error(\"Canal introuvable\");\r\n      }\r\n\r\n      // Vérifiez si l'utilisateur est déjà membre de l'canal\r\n      const userCanalsRef = collection(db, \"userCanals\");\r\n      const querySnapshot = await getDocs(\r\n        query(\r\n          userCanalsRef,\r\n          where(\"userId\", \"==\", userId),\r\n          where(\"canalId\", \"==\", canalId)\r\n        )\r\n      );\r\n      if (!querySnapshot.empty) {\r\n        throw new Error(\"L'utilisateur est déjà membre de cette canal\");\r\n      }\r\n\r\n      // Ajoutez l'ID de l'canal à la collection \"userCanals\" de l'utilisateur\r\n      await addDoc(userCanalsRef, { userId, canalId });\r\n\r\n      // Ajoutez le rôle de l'utilisateur à l'canal\r\n      const newRole = { uid: userId, isAdmin: false };\r\n      const canalData = canalSnapshot.data();\r\n      canalData.role = [...canalData.role, newRole];\r\n\r\n      await updateDoc(canalRef, canalData);\r\n\r\n      // Récupérez les données de l'canal\r\n      const updatedCanalData = {\r\n        id: canalSnapshot.id,\r\n        ...canalData,\r\n      };\r\n\r\n      return updatedCanalData;\r\n    } catch (error) {\r\n      return rejectWithValue(error.message);\r\n    }\r\n  }\r\n);\r\n\r\n/*\r\n * Add canal profile image\r\n ***\r\n */\r\n\r\nexport const uploadImage = async (image) => {\r\n  try {\r\n    const storage = getStorage();\r\n    const storageRef = ref(storage, `images/${image.name}`);\r\n    await uploadBytes(storageRef, image);\r\n    const imageUrl = await getDownloadURL(storageRef);\r\n    return imageUrl;\r\n  } catch (error) {\r\n    throw new Error(\r\n      `Une erreur s'est produite lors du téléchargement de l'image : ${error.message}`\r\n    );\r\n  }\r\n};\r\n\r\n/*\r\n * Update animal image\r\n ***\r\n */\r\n\r\nexport const updateCanalImage = createAsyncThunk(\r\n  \"animals/updateCanalImage\",\r\n  async ({ canalId, image }, { rejectWithValue }) => {\r\n    try {\r\n      const imageUrl = await uploadImage(image);\r\n      const db = getFirestore();\r\n      const animalRef = doc(db, \"canals\", canalId);\r\n      await updateDoc(animalRef, { image: imageUrl });\r\n\r\n      return { canalId, imageUrl };\r\n    } catch (error) {\r\n      return rejectWithValue(error.message);\r\n    }\r\n  }\r\n);\r\n\r\n/*\r\n * Modify user role\r\n ***\r\n */\r\n\r\nexport const changeUserRole = createAsyncThunk(\r\n  \"canals/changeUserRole\",\r\n  async ({ userId, canalId, newIsAdmin }, { rejectWithValue }) => {\r\n\r\n    console.log('INFORMATIONS CHANGE USER ROLE -> ')\r\n    console.log(userId, canalId, newIsAdmin)\r\n    console.log('----')\r\n    try {\r\n      const db = getFirestore();\r\n\r\n      // Vérifiez si l'utilisateur existe dans la collection \"users\"\r\n      const userRef = doc(db, \"users\", userId);\r\n      const userSnapshot = await getDoc(userRef);\r\n      if (!userSnapshot.exists()) {\r\n        throw new Error(\"Utilisateur introuvable\");\r\n      }\r\n\r\n      // Vérifiez si l'canal existe dans la collection \"canals\"\r\n      const canalRef = doc(db, \"canals\", canalId);\r\n      const canalSnapshot = await getDoc(canalRef);\r\n      if (!canalSnapshot.exists()) {\r\n        throw new Error(\"Canal introuvable\");\r\n      }\r\n\r\n      // Mettre à jour le rôle de l'utilisateur dans l'canal\r\n      const canalData = canalSnapshot.data();\r\n      for (let role of canalData.role) {\r\n        if (role.uid === userId) {\r\n          role.isAdmin = newIsAdmin;\r\n          break;\r\n        }\r\n      }\r\n\r\n      await updateDoc(canalRef, canalData);\r\n\r\n      // Récupérez les données de l'canal\r\n      const updatedCanalData = {\r\n        id: canalSnapshot.id,\r\n        ...canalData,\r\n      };\r\n\r\n      return updatedCanalData;\r\n    } catch (error) {\r\n      return rejectWithValue(error.message);\r\n    }\r\n  }\r\n);\r\n\r\n// export const getCanal = createAsyncThunk<Canal, string>(\r\n//   'canals/getCanal',\r\n//   async (canalId: string | any , { rejectWithValue }) => {\r\n//     try {\r\n//       const db = getFirestore();\r\n//       const canalRef = doc(db, 'canals', canalId);\r\n//       const canalSnapshot = await getDoc(canalRef);\r\n\r\n//       if (!canalSnapshot.exists()) {\r\n//         throw new Error('Canal not found');\r\n//       }\r\n\r\n//       const canalData = canalSnapshot.data();\r\n//       let isAdmin = false;\r\n\r\n//       if (Array.isArray(canalData.role)) {\r\n//         // Use your logic here to determine if a user is an admin\r\n//         // For example:\r\n//         // const { uid } = firebase.auth().currentUser;\r\n//         // isAdmin = canalData.role.some(role => role.uid === uid && role.isAdmin);\r\n//       }\r\n\r\n//       return { id: canalId, isAdmin, ...canalData };\r\n//     } catch (err) {\r\n//       return rejectWithValue(err.message || 'Unknown error');\r\n//     }\r\n//   }\r\n// );\r\n\r\nconst canalsSlice = createSlice({\r\n  name: \"canals\",\r\n  initialState: {\r\n    status: \"idle\",\r\n    data: [],\r\n    error: null,\r\n  } as CanalState,\r\n  reducers: {},\r\n  extraReducers: (builder) => {\r\n    builder\r\n      .addCase(fetchCanals.pending, (state) => {\r\n        state.status = \"loading\";\r\n      })\r\n      .addCase(\r\n        fetchCanals.fulfilled,\r\n        (state, action: PayloadAction<Canal[]>) => {\r\n          state.status = \"succeeded\";\r\n          state.data = action.payload;\r\n        }\r\n      )\r\n      .addCase(\r\n        fetchCanals.rejected,\r\n        (state, action: PayloadAction<any>) => {\r\n          state.status = \"failed\";\r\n          state.error = action.payload;\r\n        }\r\n      )\r\n      .addCase(addCanal.pending, (state) => {\r\n        state.status = \"loading\";\r\n      })\r\n      .addCase(addCanal.fulfilled, (state, action) => {\r\n        state.status = \"succeeded\";\r\n        state.data.push(action.payload);\r\n      })\r\n      .addCase(addCanal.rejected, (state, action) => {\r\n        state.status = \"failed\";\r\n        state.error = action.payload;\r\n      })\r\n      .addCase(updateCanal.pending, (state) => {\r\n        state.status = \"loading\";\r\n      })\r\n      .addCase(updateCanal.fulfilled, (state, action) => {\r\n        state.status = \"succeeded\";\r\n        console.log('ouyai')\r\n        state.data = state.data.map((canal) => {\r\n          if (canal.id === action.payload.canalId) {\r\n            return { ...canal, ...action.payload.canalData };\r\n          }\r\n          return canal;\r\n        });\r\n        if (\r\n          state.selectedCanal &&\r\n          state.selectedCanal.id === action.payload.canalId\r\n        ) {\r\n          state.selectedCanal = {\r\n            ...state.selectedCanal,\r\n            ...action.payload.canalData,\r\n          };\r\n        }\r\n      })\r\n      .addCase(updateCanal.rejected, (state, action) => {\r\n        state.status = \"failed\";\r\n        state.error = action.payload;\r\n      });\r\n    builder\r\n      .addCase(joinCanal.pending, (state) => {\r\n        state.status = \"loading\";\r\n      })\r\n      .addCase(joinCanal.fulfilled, (state, action) => {\r\n        state.status = \"succeeded\";\r\n        state.data.push(action.payload);\r\n      })\r\n      .addCase(joinCanal.rejected, (state, action) => {\r\n        state.status = \"failed\";\r\n        state.error = action.payload;\r\n      });\r\n\r\n    builder\r\n    .addCase(changeUserRole.pending, (state) => {\r\n      state.status = \"loading\";\r\n    })\r\n    .addCase(changeUserRole.fulfilled, (state, action) => {\r\n      state.status = \"succeeded\";\r\n    \r\n      // Trouver l'index de l'canal à mettre à jour dans le tableau\r\n      const index = state.data.findIndex(\r\n        (canal) => canal.id === action.payload.id\r\n      );\r\n    \r\n      if (index !== -1) {\r\n        // Remplacer l'canal existante par la nouvelle\r\n        state.data[index] = action.payload;\r\n      }\r\n    })\r\n    .addCase(changeUserRole.rejected, (state, action) => {\r\n      state.status = \"failed\";\r\n      state.error = action.payload;\r\n    });\r\n\r\n    builder\r\n      .addCase(updateCanalImage.pending, (state) => {\r\n        state.status = \"loading\";\r\n      })\r\n      .addCase(updateCanalImage.fulfilled, (state, action) => {\r\n        state.status = \"succeeded\";\r\n        const { canalId, imageUrl } = action.payload;\r\n        const canal = state.data.find(\r\n          (canal) => canal.id === canalId\r\n        );\r\n        if (canal) {\r\n          canal.image = imageUrl;\r\n        }\r\n        if (state.selectedAnimal && state.selectedAnimal.id === canalId) {\r\n          state.selectedAnimal.image = imageUrl;\r\n        }\r\n      })\r\n      .addCase(updateCanalImage.rejected, (state, action) => {\r\n        state.status = \"failed\";\r\n        state.error = action.payload;\r\n      });\r\n\r\n    builder.addCase(removeCanal.pending, (state) => {\r\n      state.status = \"loading\";\r\n    });\r\n    builder\r\n      .addCase(removeCanal.fulfilled, (state, action) => {\r\n        state.status = \"succeeded\";\r\n        // remove the canal from the state\r\n        state.data = state.data.filter(\r\n          (canal) => canal.id !== action.payload.id\r\n        );\r\n      })\r\n\r\n      .addCase(removeCanal.rejected, (state, action) => {\r\n        state.status = \"failed\";\r\n        state.error = action.payload;\r\n      });\r\n\r\n    // .addCase(getCanal.pending, (state) => {\r\n    //   state.status = 'loading';\r\n    // })\r\n    // .addCase(getCanal.fulfilled, (state, action: PayloadAction<Canal>) => {\r\n    //   state.status = 'succeeded';\r\n    //   state.data = [action.payload]; // This will overwrite the entire list of canals with the single one that was fetched\r\n    //   console.log('DATA ASSOCIATION')\r\n    //   console.log(state.data)\r\n    // })\r\n    // .addCase(getCanal.rejected, (state, action: PayloadAction<any>) => {\r\n    //   state.status = 'failed';\r\n    //   state.error = action.payload;\r\n    // });\r\n  },\r\n});\r\n\r\nexport default canalsSlice.reducer;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}